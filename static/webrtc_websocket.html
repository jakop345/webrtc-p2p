<html>
<head>
<script src="jquery-1.7.2.min.js"></script>
<script src="webrtc-p2p.js"></script>
<script src="control.js"></script>
<script type="text/javascript" src="common.js"></script>
<script type="text/javascript" src="example.js"></script>
</head>
<body>
<fieldset>
<legend>JOIN</legend>
<p>group_id:<input id="group_id" /><button onclick="join()">JOIN</button>    ID:<span id="id"></span></p>
</fieldset>
<fieldset>
<legend>PUBLISH</legend>
<p><button onclick="publishCAM()">cam</button><button onclick="publishScreen()">screen</button><button onclick="unPublish()">unpublish</button></p>
<p><button onclick="createDC()">New DC</button><button onclick="sendDC()">Send DC</button><button onclick="createDC2()">New DC2</button><button onclick="sendDC2()">Send DC2</button></p>
</fieldset>
<fieldset>
<legend>RD</legend>
<p><button onclick="controllee()">±»¿Ø¶Ë</button><button onclick="controller()">¿ØÖÆ¶Ë</button></p>
</fieldset>
local:
<p><video id="lv" autoplay></video></p>
remote:
<p><video id="v" autoplay></video></p>
<fieldset>
<legend>LOG</legend>
<p id="console" style="width:100%;font-size:14px;"></p>
</fieldset>
    <div id="listener"></div>

<script>
var client;
function join(){
    client = new RTCClient("ws://192.168.0.9:8080/"+$("#group_id").val(),{"iceServers":[{ "url": "stun:115.25.138.230" }]} , function (id) {
        document.getElementById("id").textContent = id;
    });
    client.ondatachannel = function (Channel) {
        if (Channel.label == "Test1")
            channel = Channel;
        else if (Channel.label == "Test2")
            channel2 = Channel;
        else if (Channel.label == "RD")
            dc_rd = Channel;

        Channel.onmessage = function (data) { alert(data) };
    }
    client.onaddstream = function (stream) {
        document.getElementById('v').src = URL.createObjectURL(stream);//debug
    }
}
function log(content){
	document.getElementById("console").innerHTML += content + '<br/>';
}
var stream;

function publishScreen() {
    navigator.webkitGetUserMedia({video:{mandatory:{chromeMediaSource:'screen'},optional:[]},audio:false},
	function (Stream) {
	    stream = Stream;
	    document.getElementById('lv').src = URL.createObjectURL(stream);//debug

	    client.addStream(stream);
	},
	function (e) {
	    alert(e.name + ":" + e.message);
	});
}
function publishCAM(){
	navigator.webkitGetUserMedia({video:true,audio:false},
	function (Stream) {
	    stream = Stream;
		document.getElementById('lv').src = URL.createObjectURL(stream);//debug

		client.addStream(stream);
	},
	function(e){
		alert(e.name+":"+e.message);
	});
}

function unPublish(){
	client.removeStream(stream);
}
var channel,channel2;
function createDC()
{
    channel = client.createDataChannel("Test1");
    channel.onmessage=function(data){alert(data)}
}
function sendDC()
{
    channel.send("test1");
}
function createDC2() {
    channel2 = client.createDataChannel("Test2");
    channel2.onmessage = function (data) { alert(data) }
}
function sendDC2() {
    channel2.send("test2");
}
function controllee(){
    publishScreen();
    dc_rd = client.createDataChannel("RD");
    dc_rd.onmessage = function (data) { post(data) }
}
var dc_rd;
function controller() {
    init_controller(document.getElementById('v'));
}
</script>
</body>
</html>